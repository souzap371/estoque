<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Dar Baixa</title>

  <style>
    body {
      font-family: Arial;
      background: #f4f6f9;
    }

    .container {
      width: 400px;
      margin: 50px auto;
      background: white;
      padding: 20px;
      border-radius: 6px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input,
    select,
    button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }

    button {
      background: #1e88e5;
      color: white;
      border: none;
      margin-top: 15px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>üí∞ Dar Baixa</h2>

    <input type="hidden" id="contaId" th:value="${contaId}">

    <label>Valor da Baixa</label>
    <input type="number" id="valor" step="0.01">

    <label>Data da Baixa</label>
    <input type="date" id="data">

    <label>Forma de Pagamento</label>
    <select id="forma">
      <option value="PIX">PIX</option>
      <option value="PI_VIT">PIX_VIT</option>
      <option value="CHEQUE">CHEQUE</option>
      <option value="CHEQUE_PRE">CHEQUE_PRE</option>
      <option value="CC">Cart√£o Cr√©dito</option>
      <option value="CD">Cart√£o D√©bito</option>
      <option value="DEPOSITO">Dep√≥sito</option>
      <option value="DEPOSITO_VIT">Dep√≥sito_VIT</option>
      <option value="ESPECIE">Esp√©cie</option>
      <option value="GNRE">GNRE</option>
      <option value="CARRO">Carro</option>
      <option value="MOTO">Moto</option>
      <option value="IMOVEL">Im√≥vel</option>
    </select>

    <label>Anexo (PDF / Imagem)</label>
    <input type="file" id="anexo" accept=".pdf,.jpg,.jpeg,.png">


    <button onclick="confirmarBaixa()">Confirmar Baixa</button>
    <button onclick="window.location.href='/financeiro'">Voltar </button>
  </div>
  

  <script>

    function confirmarBaixa() {

      const formData = new FormData();
      formData.append("valor", document.getElementById("valor").value);
      formData.append("data", document.getElementById("data").value);
      formData.append("formaPagamento", document.getElementById("forma").value);

      const anexo = document.getElementById("anexo").files[0];
      if (anexo) {
        formData.append("anexo", anexo);
      }

      const id = document.getElementById("contaId").value;

      fetch(`/financeiro/api/baixar/${id}`, {
        method: "POST",
        body: formData
      })
        .then(res => {
          if (!res.ok) throw new Error();
          alert("Baixa registrada com sucesso!");
          window.location.href = "/financeiro";
        })
        .catch(() => alert("Erro ao registrar baixa"));
    }
  </script>

</body>

</html>